# 【通信总协议】
### 【最终协议以此为准】
#### 》》协议表格中，若带 0x 开头代表该值是16进制，无0x开头，则为十进制《《
|编号 | 0| 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 |11  |12  |13  |14  |15|
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |--- |--- |
|数据包所代表 | 包头 | 包头 |模式位  | 数据长度位 |保留位  |保留位 |保留位 |保留位 | 保留位  |保留位  |保留位  | 保留位 |保留位| 保留位| 保留位|累加和校验sum|
|描述 | 0xAA| 0x55 | 1~255 | <12 |  |  |  |  |  |   |  |  |  | || sum



1. AA 55为包头
2. 模式位：巡线远程模式等等
2. 数据长度位：代表后面除校验位有几位有效数据
3. 保留位：不传输
4. 校验和：从包头开始到校验位前的所有数据和的低八位


* * *
#### 一：远程调参――1-3
|编号 | 0| 1 | 2 | 3 | 4 | 5 | 6 | 7 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
|数据包所代表 | 包头 | 包头 |模式位  | 数据长度位 |参数序号  |参数高8位 |参数低8位 |累加和校验sum|
|描述 | 0xAA| 0x55 | 1~3 | 0x03 |1~10 |xx|xx| sum

**例如：AA 55 01 03 01 81 25 AA**

1. 模式位：
    * 01：巡线模式相关参数修改
    * 02：寻色块模式相关参数修改
    * 03：穿框模式相关参数修改
2. 数据长度位：0x03代表3位有效数据
3. 参数序号：0x01代表修改第1参数数据
    * 01：巡线模式相关参数序号――参数序号1~10
    * 02：寻色块模式相关参数序号――参数序号1~10
    * 03：穿框模式相关参数序号――参数序号1~10
2. 参数高8位：0x81
3. 参数低8位：0x25，结合高8位为0x8125


* * *


#### 二：查询变量模式――9
##### 1、地面端：
|编号 | 0| 1 | 2 | 3 | 4 | 5 |
| --- | --- | --- | --- | --- | --- | --- |
|数据包所代表 | 包头 | 包头 |模式位  | 数据长度位 |查询序号  |累加和校验sum|
|描述 | 0xAA| 0x55 | 9 | 1 |1~3 | sum

1. 模式位：9查询参数模式
2. 查询序号：
    * 01：查询巡线模式相关参数――参数序号1~10
    * 02：查询寻色块模式相关参数――参数序号1~10
    * 03：查询穿框模式相关参数――参数序号1~10

##### 9、飞控端返回：
|编号 | 0| 1 | 2 | 3 | 4 | 5 | 6 | 7 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
|数据包所代表 | 包头 | 包头 |查询模式位说明  | 数据长度位 |参数序号  |参数高8位 |参数低8位 |累加和校验sum|
|描述 | 0xAA| 0x55 | 1~3 | 0x03 |1~10 |xx|xx| sum

1. 查询模式位说明
    * 01：返回巡线模式相关参数――参数序号1~10
    * 02：返回寻色块模式相关参数――参数序号1~10
    * 03：返回穿框模式相关参数――参数序号1~10


* * *
#### 三：openmv通信
##### 1、寻找单色块：
|编号 |0| 1| 2 | 3 | 4 | 5 | 
| --- | --- | --- | --- | --- | --- | --- |
|数据包所代表 | 包头 | 包头 |模式位  | 数据长度位 |识别为  | 累加和校验|
|描述 | AA| 55 | 11 | 0x01  | 0或1 | sum



##### 2、寻找线：
|编号 | 1| 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11|
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
|数据包所代表 | 包头 | 包头 |模式位  | 数据长度位 |1区X  |1区Y  |2区X |2区Y | 3区X  |3区Y|累加和校验|
|描述 | AA| 55 | 12 | 0x06 |    ||||| | sum

* X：0-160
* Y：0~120

##### 3、条形码:
|编号 | 1| 2 | 3 | 4 | 5 | 6 | 
| --- | --- | --- | --- | --- | --- | --- |  
|数据包所代表 | 包头 | 包头 |模式位  | 数据长度位 |标志位|累加和校验|
|描述 | AA| 55 | 13 | 0x01 |  0或者1 |  sum| 


##### 4、二维码:
|编号 | 1| 2 | 3 | 4 | 5 | 6 | 
| --- | --- | --- | --- | --- | --- | --- |  
|数据包所代表 | 包头 | 包头 |模式位  | 数据长度位 |标志位|累加和校验|
|描述 | AA| 55 | 14 | 0x01 |  0或者1 |  sum| 


##### 5、拍摄返回:
|编号 | 1| 2 | 3 | 4 | 5 | 6 |  
| --- | --- | --- | --- | --- | --- | --- |  
|数据包所代表 | 包头 | 包头 |模式位  | 数据长度位 |标志位 |累加和校验|
|描述 | AA| 55 | 15 | 0x01    |0或者1 |  sum| 

##### 6、拍摄开始:
|编号 | 1| 2 | 3 | 4 | 5 | 6 |  
| --- | --- | --- | --- | --- | --- | --- |  
|数据包所代表 | 包头 | 包头 |模式位  | 数据长度位 |标志位 |累加和校验|
|描述 | AA| 55 | 16 | 0x01    |0或者1 |  sum| 


##### 7、转弯标志:
|编号 | 1| 2 | 3 | 4 | 5 | 6 |  
| --- | --- | --- | --- | --- | --- | --- |  
|数据包所代表 | 包头 | 包头 |模式位  | 数据长度位 |标志位 |累加和校验|
|描述 | AA| 55 | 17 | 0x01    |0或者1 |  sum| 




##### 9、飞控指令：
|编号 | 0| 1 | 2 | 3 | 4 | 5 |
| --- | --- | --- | --- | --- | --- | --- |
|数据包所代表 | 包头 | 包头 |模式位  | 数据长度位 |控制指令  |累加和校验sum|
|描述 | 0xAA| 0x55 | 19 | 1 |>1 | sum

- 控制指令：
    - 01：分区巡线模式
    - 02：色块模式
    - 03：巡线模式
    - 04：找圆
    - 05：找十字
    - 其它非0：不识别

- 切换模式后需要大概2-3秒的缓冲时间（重新初始化openmv）

* * *
#### 四：树莓派通信
##### 1、穿框：
|编号 | 1| 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | 
|数据包所代表 | 包头 | 包头 |模式位  | 数据长度位 |距离框的简单距离 | 框中心坐标x高8位  | 框中心坐标x低8位  |框中心坐标y高8位  | 框中心坐标y低8位 | 识别标志位| 累加和校验|
|描述 | 0xAA| 0x55 | 21 | 0x06 |  |  |  |  |  |0或1 | sum

- 距离框的简单距离：单位cm，最大255cm
- 框距离：（x,y），画幅左上角（0，0）
- 识别标志：0x01为识别到 0x00未识别到

##### 2、识别数字和字母：
|编号 | 1| 2 | 3 | 4 | 5 | 6 | 7 |
| --- | --- | --- | --- | --- | --- | --- | --- | 
|数据包所代表 | 包头 | 包头 |模式位  | 数据长度位 |数字和字母 | 识别标志位| 累加和校验|
|描述 |0xAA|0x55 | 22 | 0x02 |  |0或1 | sum

- 数字和字母：0~9代表数字0~9；11~36代表26个英文字母
- 识别标志：0x01为识别到 0x00未识别到

##### 9、飞控指令：
|编号 | 0| 1 | 2 | 3 | 4 | 5 |
| --- | --- | --- | --- | --- | --- | --- |
|数据包所代表 | 包头 | 包头 |模式位  | 数据长度位 |控制指令  |累加和校验sum|
|描述 | 0xAA| 0x55 | 29 | 1 |0~3 | sum

- 控制指令：
    - 00：不进行识别操作
    - 01：穿框模式
    - 02：识别数字模式
    - 03：识别字母模式

* * *
#### 五：多功能执行端
##### 1、激光等外设：(由飞控发送)
|编号 | 0| 1 | 2 | 3 | 4 | 5 |
| --- | --- | --- | --- | --- | --- | --- |
|数据包所代表 | 包头 | 包头 |模式位  | 数据长度位 |控制指令  |累加和校验sum|
|描述 | 0xAA| 0x55 | 31 | 1 |0 ~ 8 | sum

0：关激光――关蜂鸣器――关灯
* 控制指令――1：关闭激光
* 控制指令――2：开启激光
* 控制指令――3：关蜂鸣器
* 控制指令――4：开蜂鸣器
* 控制指令――5：关灯
* 控制指令――6：开灯
* 控制指令――7：舵机张开
* 控制指令――8：舵机闭合
##### 2、电压检测：（发送给地面端）
|编号 | 0| 1 | 2 | 3 | 4 | 5 |6|
| --- | --- | --- | --- | --- | --- | --- | --- |
|数据包所代表 | 包头 | 包头 |模式位  | 数据长度位 |高八位  |低八位|累加和校验sum|
|描述 | 0xAA| 0x55 | 32 | 2 |xx| xx|sum

* 检测到电压值*100发送给地面站

##### 3、高度返回：
|编号 | 0| 1 | 2 | 3 | 4 | 5 |6|
| --- | --- | --- | --- | --- | --- | --- | --- |
|数据包所代表 | 包头 | 包头 |模式位  | 数据长度位 |高八位  |低八位|累加和校验sum|
|描述 | 0xAA| 0x55 | 33 | 2 |xx| xx|sum

##### 4、模式输入：
|编号 | 0| 1 | 2 | 3 |  4 |5|
| --- | --- | --- | --- | --- | --- | --- |  
|数据包所代表 | 包头 | 包头 |模式位  | 数据长度位 | 数据位  |累加和校验sum|
|描述 | 0xAA| 0x55 | 34 | 1 |xx |sum

* 数据位：1~16为拨码开关的16种模式，0xDB（即219）为一键起飞模式